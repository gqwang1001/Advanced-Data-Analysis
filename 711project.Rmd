---
title: "711 Project"
author: "Guoqing Wang"
date: "September 9, 2016"
output: html_document
---

```{r setup, include=FALSE}
# knitr::opts_chunk$set(echo = TRUE)
# install.packages("foreign")
# install.packages("downloader")
# install.packages("utils")
# install.packages("readr")
# install.packages("xts")
library(foreign)
library(downloader)
library(utils)
library(readr)
library(ggplot2)
library(xts)
setwd("/Users/guoqingwang/OneDrive - Johns Hopkins University/Coursework/dataananlysis/project/711project")
yearlist =2001:2015
accident = vector("list",length(yearlist))
names(accident) = as.character(yearlist)
year_names = as.character(yearlist)
```

## Introduction
The aim of this analysis is to estimate the relationship between fatal crashes and speeding, distracted driving. The data used in this research is obtained from the Fatality
Analysis Reporting System of the National Highway Traffic Safety Administration, focused on the
Maryland and Washington, DC area from years 2013 to 2015. We paid more attention on predicting the manner of collision on different speeding and distracted driving level. 
One other option is to estimate the number of fatality each month.

```{r download data,eval=F}
for(i in 1:length(yearlist)){
  if (yearlist[i]<2012){
    fileurl = paste0("ftp://ftp.nhtsa.dot.gov/fars/",yearlist[i],"/DBF/FARS",yearlist[i],".zip")
    destdir = paste0("../FARS",yearlist[i],".zip")
  }else if (yearlist[i] == 2012){
    fileurl = paste0("ftp://ftp.nhtsa.dot.gov/fars/",yearlist[i],"/National/DBF/FARS",yearlist[i],".zip")
    destdir = paste0("../FARS",yearlist[i],".zip")
  }else{
    fileurl = paste0("ftp://ftp.nhtsa.dot.gov/fars/", yearlist[i],
                "/National/FARS",yearlist[i],"NationalDBF.zip")
    destdir = paste0("../FARS",yearlist[i],"NationalDBF.zip")
  }
download.file(fileurl,destfile = destdir, method = "curl")
unzip(destdir,exdir = paste0("../data",yearlist[i]))
}
```


```{r exploratary}
for(i in 1:length(yearlist)){
accident1 = read.dbf(paste0("../data", yearlist[i],"/accident.dbf"))
accident[[i]] = accident1
}

month_acc = c()
for(i in 1:length(yearlist)){
month1 = accident[[year_names[i]]]
month_acc = cbind(month_acc,as.vector(table(month1$MONTH)))
}

accci_month = data.frame(year = rep(yearlist,each = 12), month = rep(1:(12*length(yearlist))),
                         num_fatal = as.vector(month_acc),
                         ym = seq(as.Date(paste0(yearlist[1],"-01-01")),by = "month",along = rep(yearlist,each = 12)))

ggplot(data = accci_month,aes(ym,num_fatal))+geom_line()+xlab("Year")+ylab("Number of Fatality")
```